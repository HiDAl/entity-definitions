relationships:
  # Select entityGuid, peer.hostname from Span where peer.hostname is not null and category =
  # 'datastore'
  # ExtService in this case is a DB
  - provider: newrelic
    eventType: Span
    rootEntityNodeType: SOURCE
    relationship: CALLS
    relatedEntity:
      domain: EXT
      type: SERVICE
      domainId: peer.hostname
      encodeIdentifierInGUID: true
    conditions:
      - attribute: category
        value: datastore

  # SELECT count(*) From Span facet request.domain where request.domain is not null and
  # entityGuid is not null
  - provider: newrelic
    eventType: Span
    rootEntityNodeType: SOURCE
    relationship: CALLS
    relatedEntity:
      domain: EXT
      type: SERVICE
      domainId: request.domain
      encodeIdentifierInGUID: true
    conditions:
      - attribute: request.domain
